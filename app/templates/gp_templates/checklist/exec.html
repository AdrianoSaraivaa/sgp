{% extends "_base.html" %}
{% block title %}Checklist — Execução (B8){% endblock %}
{% block subtitle %}Execução guiada por template (JSON){% endblock %}

{% block head_extra %}
<style>
  .wrap { max-width: 1100px; margin: 0 auto; padding: 16px; }
  .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  .card { background: #fff; border: 1px solid #e6e6e6; border-radius: 8px; padding: 12px; }
  .card h3 { margin: 0 0 10px; color: #e60000; }
  .meta { display:flex; gap:10px; flex-wrap: wrap; }
  .meta > div { min-width: 180px; }
  .controls { display:flex; gap:8px; flex-wrap: wrap; margin-top: 8px; }
  .items { margin-top: 14px; }
  .item { border:1px solid #eee; border-radius:8px; padding:10px; margin-bottom:10px; display:grid; grid-template-columns: 40px 1fr 120px 120px 120px 150px; gap:8px; align-items:center; }
  .item.locked { opacity: 0.6; }
  .item .ord { text-align:center; font-weight:600; }
  .item .desc { font-size: 14px; }
  .tag { display:inline-block; padding:2px 6px; border-radius: 6px; background:#f2f2f2; font-size: 12px; }
  .ok { color: #0a7a0a; font-weight:600; }
  .no { color: #b30000; font-weight:600; }
  .hold { user-select:none; }
  .timer { font-family: monospace; text-align:center; }
  .btn { padding:6px 10px; border:1px solid #ccc; background:#fafafa; border-radius:6px; cursor:pointer; }
  .btn.primary { background:#e60000; color:#fff; border-color:#e60000; }
  .btn.ghost { background:transparent; }
  .btn.small { padding:4px 8px; font-size:12px; }
  .footer { display:flex; justify-content:flex-end; margin-top:14px; }
  .hidden { display:none; }
  .status-badge { padding:4px 8px; border-radius:6px; font-size:12px; }
  .status-open { background:#fff6e6; border:1px solid #ffd699; }
  .status-ok { background:#e6ffec; border:1px solid #b3f0c6; }
  .status-fail { background:#ffe6e6; border:1px solid #ffb3b3; }
  .pin-input { width: 100px; }
  .modal { position: fixed; inset: 0; background: rgba(0,0,0,.35); display: none; align-items: center; justify-content: center; padding: 16px; }
  .modal .box { background: #fff; border-radius: 10px; width: 640px; max-width: 100%; padding: 16px; }
  .modal .box h3 { margin-top: 0; }
  .modal .row { display:flex; gap:8px; margin-bottom:8px; }
  .modal label { min-width: 120px; display:inline-block; }
  .modal textarea, .modal input, .modal select { width: 100%; padding:6px; border:1px solid #ccc; border-radius:6px; }
  .modal .actions { display:flex; gap:10px; justify-content:flex-end; margin-top: 10px; }
</style>
{% endblock %}

{% block content %}
<div class="wrap">
  <div class="card">
    <h3>Dados de execução</h3>
    <div class="meta">
      <div>
        <label><b>Serial</b></label>
        <input id="inpSerial" placeholder="Ler ou digitar serial" />
      </div>
      <div>
        <label><b>Modelo</b></label>
        <select id="selModelo">
          <option value="PM700">PM700</option>
          <option value="PM2100">PM2100</option>
          <option value="PM2200">PM2200</option>
        </select>
      </div>
      <div>
        <label><b>Operador</b></label>
        <input id="inpOperador" placeholder="Nome do operador" />
      </div>
      <div>
        <label><b>Tolerância início</b></label>
        <input id="inpTol" type="number" value="0.9" step="0.05" min="0.5" max="1" />
      </div>
    </div>
    <div class="controls">
      <button class="btn" id="btnCarregar">Carregar template</button>
      <button class="btn" id="btnPreview">Prévia</button>
    </div>
  </div>

  <div class="card">
    <h3>Execução</h3>
    <div id="execStatus" class="status-badge status-open">Checklist aberto</div>
    <div class="items" id="items"></div>
    <div class="footer">
      <button class="btn primary" id="btnFinalizar" disabled>Finalizar checklist</button>
    </div>
  </div>
</div>

<!-- Modal NCR -->
<div class="modal" id="modalNcr">
  <div class="box">
    <h3>Registrar ocorrência (NCR)</h3>
    <div class="row"><label>Item</label><input id="ncrItem" disabled /></div>
    <div class="row"><label>Categoria</label><select id="ncrCategoria"><option>Falha de processo</option><option>Falha de componente</option><option>Outros</option></select></div>
    <div class="row"><label>Descrição</label><textarea id="ncrTexto" rows="4" placeholder="Descreva a ocorrência"></textarea></div>
    <div class="actions">
      <button class="btn" id="btnNcrCancelar">Cancelar</button>
      <button class="btn primary" id="btnNcrSalvar">Salvar</button>
    </div>
  </div>
</div>

<!-- Modal PIN -->
<div class="modal" id="modalPin">
  <div class="box">
    <h3>PIN do Supervisor</h3>
    <div class="row"><label>Motivo</label><input id="pinMotivo" placeholder="Ex.: liberar antes do tempo" /></div>
    <div class="row"><label>PIN</label><input id="pinCode" class="pin-input" type="password" /></div>
    <div class="actions">
      <button class="btn" id="btnPinCancelar">Cancelar</button>
      <button class="btn primary" id="btnPinConfirmar">Confirmar</button>
    </div>
  </div>
</div>

<script src="{{ url_for('static', filename='js/gp_checklist/exec.js') }}"></script>
{% endblock %}
